name: Gerar Dashboard de Lucro Semanal ðŸ“ˆ

on:
  # Roda a cada 7 dias (Todo domingo Ã s 5:00 AM)
  schedule:
    - cron: '0 5 * * 0' # <--- CRON ATUALIZADO para semanal
    
  # ExecuÃ§Ã£o Manual
  workflow_dispatch:
    inputs:
      motivo:
        description: 'Motivo da execuÃ§Ã£o manual do dashboard semanal de Lucro'
        required: false
        default: 'VerificaÃ§Ã£o rÃ¡pida do Lucro'

jobs:
  build_historico:
    runs-on: ubuntu-latest
    
    permissions:
      contents: write

    steps:
      - name: Checkout do RepositÃ³rio
        uses: actions/checkout@v4

      - name: Configurar Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: Instalar DependÃªncias
        # Agora sÃ³ precisamos de pandas e gspread. O scikit-learn Ã© sÃ³ para o ML.
        run: |
          pip install pandas gspread

      - name: Executar o Analisador de Lucro Semanal
        env:
          GCP_SA_CREDENTIALS: ${{ secrets.GCP_SA_CREDENTIALS }}
        run: |
          python analise_historica.py # <--- Script correto para o Lucro Semanal

      - name: Commit e Push do Dashboard de Lucro
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "AtualizaÃ§Ã£o automÃ¡tica do Dashboard de Lucro Semanal"
          file_pattern: dashboard_lucro_semanal.html # <--- NOVO ARQUIVO DE SAÃDA

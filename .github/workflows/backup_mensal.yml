name: Consolida√ß√£o Mensal de Dados

# 1. QUANDO RODAR (GATILHO)
on:
  schedule:
    # Roda no primeiro dia de cada m√™s, √† 00:00 (meia-noite) UTC.
    - cron: '0 0 1 * *' 
  
  workflow_dispatch:

# 2. OS TRABALHOS (JOB)
jobs:
  run_monthly_consolidation:
    runs-on: ubuntu-latest

    steps:
      - name: üì¶ Checkout C√≥digo
        uses: actions/checkout@v4

      # üêç Configura√ß√£o do ambiente Python e Instala√ß√£o de depend√™ncias
      - name: Set up Python e Instalar Depend√™ncias
        uses: actions/setup-python@v5
        with:
          python-version: '3.x' 
      
      - name: Instalar gspread e Outras Bibliotecas
        # √â fundamental que gspread esteja neste arquivo!
        run: pip install -r requirements.txt

      # üîê PASSO 3: CRIA O ARQUIVO DE CREDENCIAIS
      - name: Criar Arquivo de Credenciais
        # Nota: O conte√∫do do seu Secret √© a string JSON.
        # O 'echo' escreve essa string no arquivo 'credenciais.json' no servidor.
        run: echo '${{ secrets.GOOGLE_CREDENTIALS }}' > credenciais.json

      # üöÄ EXECU√á√ÉO DO SCRIPT DE CONSOLIDA√á√ÉO MENSAL
      - name: Executar Consolida√ß√£o Mensal
        # O script consolidacao_mensal.py agora procurar√° por 'credenciais.json'
        run: python consolidacao_mensal.py

name: 游눶 Gerar Dashboard Hist칩rico de Gastos (Mensal) 

# 1. Configura칞칚o do Gatilho
# Roda todo dia 01 do m칡s, 맙 03:00 UTC (00:00 AM no Brasil, se estiver em -03)
on:
  schedule:
    - cron: '0 3 1 * *' 
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    # 2. Vari치veis de Ambiente e Checagem de Credenciais
    env:
      PYTHON_VERSION: '3.11'
      # O gspread vai buscar as credenciais aqui!
      GCP_SA_CREDENTIALS: ${{ secrets.GCP_SA_CREDENTIALS }} 

    steps:
    - name: 拘勇 Checkout do C칩digo Fonte
      uses: actions/checkout@v4

    # 3. Setup do Ambiente Python
    - name: 游냀 Configurar Python
      uses: actions/setup-python@v5
      with:
        python-version: ${{ env.PYTHON_VERSION }}

    - name: 游닍 Instalar Depend칡ncias Necess치rias
      run: |
        # As bibliotecas necess치rias para gspread e pandas
        pip install gspread pandas numpy

    # 4. Execu칞칚o do Script de An치lise de Gastos
    - name: 游끢 Executar An치lise Hist칩rica de Gastos
      # Este 칠 o script que voc칡 anexou, respons치vel por gerar o dashboard_historico_gastos.html
      run: python analise_historica_gastos.py 

    # 5. Publica칞칚o do Dashboard (Governan칞a de Arquivos)
    - name: 游 Commit e Push do Dashboard de Gastos
      uses: stefanzweifel/git-auto-commit-action@v5
      with:
        # Mensagem que aparecer치 no hist칩rico do GitHub
        commit_message: "Atualiza칞칚o autom치tica do Dashboard Hist칩rico de Gastos"
        # Garante que apenas o novo HTML seja committado (GOVERNAN칂A: Evita poluir o hist칩rico)
        file_pattern: dashboard_historico_gastos.html

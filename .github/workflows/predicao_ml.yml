name: Gerar Previs칚o de Vendas (Machine Learning) 游댩

on:
  # 1. ATIVA칂츾O MANUAL
  workflow_dispatch:
    inputs:
      motivo:
        description: 'Motivo da execu칞칚o manual (e.g., Teste SARIMA, Valida칞칚o de Dados)'
        required: false
        default: 'Ativa칞칚o manual para an치lise de qualidade de IA.'
  
  # 2. ATIVA칂츾O AGENDADA 
  schedule:
    - cron: '0 6 1 * *' 

jobs:
  build_ml:
    runs-on: ubuntu-latest
    
    permissions:
      contents: write 

    steps:
      - name: Checkout do Reposit칩rio
        uses: actions/checkout@v4

      - name: Configurar Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: Instalar Depend칡ncias (SARIMA, GSpread e MAE)
        run: |
          # pandas e gspread (dados)
          # statsmodels (para ARIMA/SARIMA)
          # scikit-learn (para o c치lculo do mean_absolute_error)
          pip install pandas gspread statsmodels scikit-learn 

      - name: Executar o Modelo de Previs칚o
        env:
          GCP_SA_CREDENTIALS: ${{ secrets.GCP_SA_CREDENTIALS }}
        run: |
          python predicao_ml.py

      - name: Commit e Push do Dashboard de ML
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "Atualiza칞칚o autom치tica do Dashboard de Previs칚o ML (Modelo SARIMA)"
          commit_body: "Motivo da Execu칞칚o: ${{ github.event.inputs.motivo || 'Execu칞칚o agendada/padr칚o.' }}"
          file_pattern: dashboard_ml_insights.html
